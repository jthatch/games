<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Click Speed Games</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: #0a0a0a;
            color: #00ff41;
            overflow: hidden;
            user-select: none;
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.2em;
            font-weight: 700;
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .dropdown-arrow {
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }
        
        .dropdown-arrow.open {
            transform: rotate(180deg);
        }
        
        .header-dropdown {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #1a1a1a, #333);
            border: 2px solid #00ff41;
            border-radius: 12px;
            padding: 20px;
            z-index: 1000;
            min-width: 300px;
            box-shadow: 0 0 25px rgba(0, 255, 65, 0.3);
            display: none;
        }
        
        .header-dropdown.open {
            display: block;
            animation: dropdownFadeIn 0.3s ease;
        }
        
        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        .dropdown-games {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .dropdown-game-btn {
            background: linear-gradient(135deg, #1a1a1a, #333);
            border: 2px solid #00ff41;
            color: #00ff41;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .dropdown-game-btn:hover {
            background: linear-gradient(135deg, #333, #555);
            box-shadow: 0 0 15px #00ff41;
        }
        
        .dropdown-game-btn.active {
            background: linear-gradient(135deg, #00ff41, #00cc33);
            color: #0a0a0a;
        }
        
        .game-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .game-btn {
            background: linear-gradient(135deg, #1a1a1a, #333);
            border: 2px solid #00ff41;
            color: #00ff41;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            transition: all 0.2s ease;
            min-width: 150px;
        }
        
        .game-btn:hover {
            background: linear-gradient(135deg, #333, #555);
            box-shadow: 0 0 15px #00ff41;
        }
        
        .game-btn.active {
            background: linear-gradient(135deg, #00ff41, #00cc33);
            color: #0a0a0a;
            box-shadow: 0 0 20px #00ff41;
        }
        
        .game-container {
            width: 100%;
            max-width: 800px;
            min-height: 500px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .game-container.active {
            display: flex;
        }
        
        .click-button {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a1a1a, #333);
            border: 4px solid #00ff41;
            color: #00ff41;
            font-size: 24px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .click-button:hover {
            background: linear-gradient(135deg, #333, #555);
            box-shadow: 0 0 25px #00ff41;
            transform: scale(1.05);
        }
        
        .click-button:active {
            transform: scale(0.95);
            box-shadow: 0 0 35px #00ff41;
        }
        
        .stats {
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
        }
        
        .stats .big-number {
            font-size: 36px;
            font-weight: 700;
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
            margin: 10px 0;
        }
        
        .reaction-screen {
            width: 100%;
            height: 70vh;
            border: 4px solid #00ff41;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.1s ease;
            margin-bottom: 20px;
        }
        
        .reaction-screen.waiting {
            background: #1a1a1a;
            color: #00ff41;
        }
        
        .reaction-screen.ready {
            background: #cc0000;
            color: #ffffff;
        }
        
        .reaction-screen.go {
            background: #00ff41;
            color: #0a0a0a;
        }
        
        .targets-area {
            width: 100%;
            height: 70vh;
            border: 4px solid #00ff41;
            border-radius: 12px;
            position: relative;
            background: #1a1a1a;
            margin-bottom: 20px;
        }
        
        .placement-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 10;
        }
        
        .placement-start-btn {
            background: linear-gradient(135deg, #00ff41, #00cc33);
            border: none;
            color: #0a0a0a;
            padding: 20px 40px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 24px;
            transition: all 0.2s ease;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.5);
        }
        
        .placement-start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(0, 255, 65, 0.7);
        }
        
        .countdown-display {
            font-size: 120px;
            font-weight: 700;
            color: #00ff41;
            text-shadow: 0 0 30px #00ff41;
            animation: countdownPulse 1s ease-in-out;
        }
        
        @keyframes countdownPulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .color-flash-screen {
            width: 100%;
            height: 70vh;
            border: 4px solid #00ff41;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.1s ease;
            margin-bottom: 20px;
            position: relative;
        }
        
        .color-target-display {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            border: 2px solid #00ff41;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff41;
            font-weight: 600;
        }
        
        .audio-reflex-screen {
            width: 100%;
            height: 70vh;
            border: 4px solid #00ff41;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.1s ease;
            margin-bottom: 20px;
            background: #1a1a1a;
            color: #00ff41;
        }
        
        .audio-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.7;
        }
        
        .shape-shifter-screen {
            width: 100%;
            height: 70vh;
            border: 4px solid #00ff41;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-bottom: 20px;
            background: #1a1a1a;
        }
        
        .shape-display {
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 150px;
            transition: all 0.2s ease;
        }
        
        .shape-circle { color: #00ff41; }
        .shape-square { color: #ff4444; }
        .shape-triangle { color: #ffaa00; }
        .shape-diamond { color: #aa44ff; }
        
        .game-instructions {
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
            color: #aaa;
            line-height: 1.4;
        }
        
        .game-container {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .game-container.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        .stats {
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .color-flash-screen:active {
            transform: scale(0.98);
        }
        
        .audio-reflex-screen:active {
            transform: scale(0.98);
        }
        
        .shape-shifter-screen:active {
            transform: scale(0.98);
        }
        
        .target {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            border: 2px solid #fff;
            position: absolute;
            cursor: pointer;
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            font-size: 14px;
        }
        
        .target:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px #ff4444;
        }
        
        .target:active {
            transform: scale(0.8);
        }
        
        .results {
            background: #1a1a1a;
            border: 2px solid #00ff41;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #333, #555);
            border: 2px solid #00ff41;
            color: #00ff41;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            transition: all 0.2s ease;
            margin: 10px;
        }
        
        .reset-btn:hover {
            background: linear-gradient(135deg, #555, #777);
            box-shadow: 0 0 15px #00ff41;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: #fff;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 18px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            border: 2px solid #fff;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .history-panel {
            background: #1a1a1a;
            border: 2px solid #00ff41;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
            max-width: 600px;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #333;
            font-size: 14px;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .global-reset {
            background: linear-gradient(135deg, #cc0000, #ff4444);
            border: 2px solid #fff;
            color: #fff;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            transition: all 0.2s ease;
            margin: 20px 10px;
        }
        
        .global-reset:hover {
            background: linear-gradient(135deg, #ff4444, #ff6666);
            box-shadow: 0 0 15px #ff4444;
        }
        
        .instructions {
            text-align: center;
            margin: 20px 0;
            font-size: 16px;
            color: #aaa;
            max-width: 600px;
            line-height: 1.5;
        }
        
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }
        
        .fullscreen-prompt {
            background: linear-gradient(135deg, #1a1a1a, #333);
            border: 3px solid #00ff41;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            color: #00ff41;
            font-family: 'JetBrains Mono', monospace;
            max-width: 300px;
            box-shadow: 0 0 30px #00ff41;
        }
        
        .fullscreen-prompt h2 {
            font-size: 24px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #00ff41;
        }
        
        .fullscreen-prompt p {
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.5;
            color: #aaa;
        }
        
        .fullscreen-btn {
            background: linear-gradient(135deg, #00ff41, #00cc33);
            border: none;
            color: #0a0a0a;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 18px;
            transition: all 0.2s ease;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }
        
        .fullscreen-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.5);
        }
        
        .pull-refresh-indicator {
            position: fixed;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #00ff41, #00cc33);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0a0a0a;
            font-size: 24px;
            font-weight: 700;
            transition: all 0.3s ease;
            z-index: 9999;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
        }
        
        .pull-refresh-indicator.visible {
            top: 20px;
        }
        
        .pull-refresh-indicator.refreshing {
            animation: refreshSpin 1s linear infinite;
        }
        
        @keyframes refreshSpin {
            0% { transform: translateX(-50%) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            .header {
                margin-bottom: 10px;
            }
            
            .header h1 {
                font-size: 1.6em;
                margin-bottom: 5px;
            }
            
            .header-dropdown {
                min-width: 280px;
                padding: 15px;
            }
            
            .global-reset {
                padding: 8px 16px;
                font-size: 14px;
                margin: 10px 0;
            }
            
            .click-button {
                width: 200px;
                height: 200px;
                font-size: 18px;
                margin-bottom: 15px;
            }
            
            .game-selector {
                flex-direction: row;
                gap: 10px;
                margin-bottom: 20px;
            }
            
            .game-btn {
                padding: 8px 12px;
                font-size: 14px;
                min-width: 100px;
            }
            
            .targets-area {
                height: 60vh;
            }
            
            .placement-start-btn {
                padding: 15px 30px;
                font-size: 20px;
            }
            
            .countdown-display {
                font-size: 80px;
            }
            
            .target {
                width: 35px;
                height: 35px;
                font-size: 12px;
            }
            
            .stats {
                font-size: 16px;
                margin: 10px 0;
            }
            
            .stats .big-number {
                font-size: 28px;
            }
            
            .history-panel {
                max-height: 120px;
                margin: 10px 0;
            }
            
            .instructions {
                font-size: 14px;
                margin: 10px 0;
            }
            
            .game-instructions {
                font-size: 12px;
                margin: 8px 0;
            }
            
            .color-flash-screen {
                height: 60vh;
                font-size: 24px;
            }
            
            .color-target-display {
                font-size: 14px;
                padding: 8px 15px;
            }
            
            .audio-reflex-screen {
                height: 60vh;
                font-size: 24px;
            }
            
            .audio-icon {
                font-size: 60px;
            }
            
            .shape-shifter-screen {
                height: 60vh;
            }
            
            .shape-display {
                font-size: 120px;
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div id="fullscreen-overlay" class="fullscreen-overlay" style="display: none;">
        <div class="fullscreen-prompt">
            <h2>GO FULLSCREEN</h2>
            <p>Tap to enter fullscreen mode for the best gaming experience</p>
            <button class="fullscreen-btn" onclick="enterFullscreen()">TAP TO START</button>
        </div>
    </div>
    
    <div id="pull-refresh-indicator" class="pull-refresh-indicator">↓</div>
    
    <div class="container">
        <div class="header">
            <h1 onclick="toggleHeaderDropdown()">
                CLICK SPEED GAMES
                <span class="dropdown-arrow" id="dropdown-arrow">▼</span>
            </h1>
            <div class="header-dropdown" id="header-dropdown">
                <div class="dropdown-games">
                    <button class="dropdown-game-btn active" onclick="switchGameFromDropdown('doubleclick')">DOUBLE CLICK</button>
                    <button class="dropdown-game-btn" onclick="switchGameFromDropdown('reaction')">REACTION TIME</button>
                    <button class="dropdown-game-btn" onclick="switchGameFromDropdown('placement')">PLACEMENT CLICK</button>
                    <button class="dropdown-game-btn" onclick="switchGameFromDropdown('colorflash')">COLOR FLASH</button>
                    <button class="dropdown-game-btn" onclick="switchGameFromDropdown('audioreflex')">AUDIO REFLEX</button>
                    <button class="dropdown-game-btn" onclick="switchGameFromDropdown('shapeshifter')">SHAPE SHIFTER</button>
                </div>
                <button class="global-reset" onclick="resetAllProgress()">RESET ALL PROGRESS</button>
            </div>
        </div>
        
        <div id="notification" class="notification"></div>
        
        <!-- Double Click Speed Game -->
        <div id="doubleclick-game" class="game-container active">
            <div class="instructions">
                Click the button twice as quickly as possible. Your double-click speed will be measured.
            </div>
            <div class="click-button" id="double-click-button">
                <span id="click-text">CLICK 1/2</span>
            </div>
            <div class="stats">
                <div>Last Time: <span class="big-number" id="last-double">--</span></div>
                <div>Best Time: <span id="best-double">--</span></div>
                <div>Attempts: <span id="attempts-double">0</span></div>
            </div>
            <div class="history-panel" id="double-history"></div>
            <button class="reset-btn" onclick="resetDoubleClick()">RESET STATS</button>
        </div>
        
        <!-- Reaction Time Game -->
        <div id="reaction-game" class="game-container">
            <div class="instructions">
                Click START, wait for RED screen, then click as soon as it turns GREEN!
            </div>
            <div class="reaction-screen waiting" onclick="handleReactionClick()" id="reaction-screen">
                <span id="reaction-text">CLICK TO START</span>
            </div>
            <div class="stats">
                <div>Best Time: <span class="big-number" id="best-reaction">--</span></div>
                <div>Last Time: <span id="last-reaction">--</span></div>
                <div>Attempts: <span id="attempts-reaction">0</span></div>
            </div>
            <div class="history-panel" id="reaction-history"></div>
            <button class="reset-btn" onclick="resetReaction()">RESET STATS</button>
        </div>
        
        <!-- Placement Click Game -->
        <div id="placement-game" class="game-container">
            <div class="instructions">
                Click all 10 targets as quickly as possible. Individual and total times will be recorded.
            </div>
            <div class="targets-area" id="targets-area">
                <div class="placement-overlay" id="placement-overlay">
                    <button class="placement-start-btn" onclick="startPlacementGameWithCountdown()">START GAME</button>
                </div>
            </div>
            <div class="stats">
                <div>Best Total: <span class="big-number" id="best-placement">--</span></div>
                <div>Last Total: <span id="last-placement">--</span></div>
                <div>Games: <span id="attempts-placement">0</span></div>
            </div>
            <div class="history-panel" id="placement-history"></div>
            <div class="results" id="placement-results" style="display: none;"></div>
            <button class="reset-btn" onclick="resetPlacement()">RESET STATS</button>
        </div>
        
        <!-- Color Flash Game -->
        <div id="colorflash-game" class="game-container">
            <div class="game-instructions">
                Watch for the target color to flash on screen. Tap immediately when you see it!
            </div>
            <div class="color-flash-screen" onclick="handleColorFlash()" id="color-flash-screen">
                <div class="color-target-display" id="color-target">TARGET: RED</div>
                <span id="color-flash-text">TAP TO START</span>
            </div>
            <div class="stats">
                <div>Best Time: <span class="big-number" id="best-colorflash">--</span></div>
                <div>Last Time: <span id="last-colorflash">--</span></div>
                <div>Attempts: <span id="attempts-colorflash">0</span></div>
            </div>
            <div class="history-panel" id="colorflash-history"></div>
            <button class="reset-btn" onclick="resetColorFlash()">RESET STATS</button>
        </div>
        
        <!-- Audio Reflex Game -->
        <div id="audioreflex-game" class="game-container">
            <div class="game-instructions">
                Put on headphones for best experience. Listen carefully and tap as soon as you hear the sound!
            </div>
            <div class="audio-reflex-screen" onclick="handleAudioReflex()" id="audio-reflex-screen">
                <div class="audio-icon">🔊</div>
                <span id="audio-reflex-text">TAP TO START</span>
            </div>
            <div class="stats">
                <div>Best Time: <span class="big-number" id="best-audioreflex">--</span></div>
                <div>Last Time: <span id="last-audioreflex">--</span></div>
                <div>Attempts: <span id="attempts-audioreflex">0</span></div>
            </div>
            <div class="history-panel" id="audioreflex-history"></div>
            <button class="reset-btn" onclick="resetAudioReflex()">RESET STATS</button>
        </div>
        
        <!-- Shape Shifter Game -->
        <div id="shapeshifter-game" class="game-container">
            <div class="game-instructions">
                Watch the pattern of shapes. Tap immediately when a different shape appears!
            </div>
            <div class="shape-shifter-screen" onclick="handleShapeShifter()" id="shape-shifter-screen">
                <div class="shape-display" id="shape-display">●</div>
            </div>
            <div id="shape-shifter-text" style="text-align: center; margin: 10px 0; color: #00ff41; font-weight: 600;">TAP TO START</div>
            <div class="stats">
                <div>Best Time: <span class="big-number" id="best-shapeshifter">--</span></div>
                <div>Last Time: <span id="last-shapeshifter">--</span></div>
                <div>Attempts: <span id="attempts-shapeshifter">0</span></div>
            </div>
            <div class="history-panel" id="shapeshifter-history"></div>
            <button class="reset-btn" onclick="resetShapeShifter()">RESET STATS</button>
        </div>
    </div>

    <script>
        // Mobile fullscreen functionality
        function enterFullscreen() {
            const overlay = document.getElementById('fullscreen-overlay');
            overlay.style.display = 'none';
            
            // Try to enter fullscreen
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.webkitRequestFullscreen) {
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) {
                document.documentElement.msRequestFullscreen();
            }
            
            // Scroll to top to hide address bar on mobile
            window.scrollTo(0, 1);
            setTimeout(() => window.scrollTo(0, 0), 100);
        }

        // Header dropdown functionality
        function toggleHeaderDropdown() {
            const dropdown = document.getElementById('header-dropdown');
            const arrow = document.getElementById('dropdown-arrow');
            
            if (dropdown.classList.contains('open')) {
                dropdown.classList.remove('open');
                arrow.classList.remove('open');
            } else {
                dropdown.classList.add('open');
                arrow.classList.add('open');
            }
        }

        function switchGameFromDropdown(game) {
            // Close dropdown
            document.getElementById('header-dropdown').classList.remove('open');
            document.getElementById('dropdown-arrow').classList.remove('open');
            
            // Update button states
            document.querySelectorAll('.dropdown-game-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Switch game
            document.querySelectorAll('.game-container').forEach(container => container.classList.remove('active'));
            document.getElementById(game + '-game').classList.add('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('header-dropdown');
            const header = document.querySelector('.header');
            
            if (!header.contains(event.target) && dropdown.classList.contains('open')) {
                dropdown.classList.remove('open');
                document.getElementById('dropdown-arrow').classList.remove('open');
            }
        });

        // Show fullscreen prompt on mobile
        function checkMobile() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                setTimeout(() => {
                    document.getElementById('fullscreen-overlay').style.display = 'flex';
                }, 500);
            }
        }

        // Pull-to-refresh functionality
        let pullToRefreshState = {
            startY: 0,
            currentY: 0,
            isRefreshing: false,
            threshold: 80
        };

        function initPullToRefresh() {
            const indicator = document.getElementById('pull-refresh-indicator');
            const container = document.querySelector('.container');
            
            // Function to check if touch target is a scrollable element
            function isScrollableElement(element) {
                const scrollableSelectors = ['.history-panel', '.results', '.targets-area'];
                return scrollableSelectors.some(selector => 
                    element.closest(selector) !== null
                );
            }
            
            // Touch events for pull-to-refresh
            container.addEventListener('touchstart', (e) => {
                // Don't trigger pull-to-refresh if touching a scrollable element
                if (isScrollableElement(e.target)) {
                    pullToRefreshState.startY = 0;
                    return;
                }
                
                if (container.scrollTop === 0 && !pullToRefreshState.isRefreshing) {
                    pullToRefreshState.startY = e.touches[0].clientY;
                }
            }, { passive: true });
            
            container.addEventListener('touchmove', (e) => {
                if (pullToRefreshState.startY === 0 || pullToRefreshState.isRefreshing) return;
                
                // Don't trigger pull-to-refresh if touching a scrollable element
                if (isScrollableElement(e.target)) {
                    resetPullToRefresh();
                    pullToRefreshState.startY = 0;
                    return;
                }
                
                pullToRefreshState.currentY = e.touches[0].clientY;
                const pullDistance = pullToRefreshState.currentY - pullToRefreshState.startY;
                
                if (pullDistance > 0 && container.scrollTop === 0) {
                    e.preventDefault();
                    
                    if (pullDistance > pullToRefreshState.threshold) {
                        indicator.classList.add('visible');
                        indicator.textContent = '↻';
                        indicator.style.transform = `translateX(-50%) scale(${Math.min(1.2, pullDistance / 100)})`;
                    } else {
                        indicator.classList.remove('visible');
                        indicator.textContent = '↓';
                        indicator.style.transform = `translateX(-50%) scale(${Math.max(0.8, pullDistance / 100)})`;
                    }
                }
            }, { passive: false });
            
            container.addEventListener('touchend', (e) => {
                if (pullToRefreshState.startY === 0 || pullToRefreshState.isRefreshing) return;
                
                const pullDistance = pullToRefreshState.currentY - pullToRefreshState.startY;
                
                if (pullDistance > pullToRefreshState.threshold) {
                    triggerRefresh();
                } else {
                    resetPullToRefresh();
                }
                
                pullToRefreshState.startY = 0;
                pullToRefreshState.currentY = 0;
            }, { passive: true });
        }

        function triggerRefresh() {
            const indicator = document.getElementById('pull-refresh-indicator');
            
            pullToRefreshState.isRefreshing = true;
            indicator.classList.add('visible', 'refreshing');
            indicator.textContent = '⟳';
            indicator.style.transform = 'translateX(-50%) scale(1)';
            
            // Simulate refresh delay then reload
            setTimeout(() => {
                window.location.reload();
            }, 800);
        }

        function resetPullToRefresh() {
            const indicator = document.getElementById('pull-refresh-indicator');
            
            indicator.classList.remove('visible', 'refreshing');
            indicator.textContent = '↓';
            indicator.style.transform = 'translateX(-50%) scale(1)';
            pullToRefreshState.isRefreshing = false;
        }

        // Game state with localStorage integration
        let gameState = {
            doubleClick: {
                firstClick: null,
                best: null,
                attempts: 0,
                history: []
            },
            reaction: {
                state: 'waiting',
                startTime: null,
                readyTime: null,
                best: null,
                attempts: 0,
                history: []
            },
            placement: {
                gameActive: false,
                currentTarget: 0,
                gameStartTime: null,
                targetTimes: [],
                best: null,
                attempts: 0,
                history: []
            },
            colorFlash: {
                state: 'waiting',
                currentColor: null,
                targetColor: 'red',
                flashTime: null,
                best: null,
                attempts: 0,
                history: []
            },
            audioReflex: {
                state: 'waiting',
                audioTime: null,
                best: null,
                attempts: 0,
                history: []
            },
            shapeShifter: {
                state: 'waiting',
                currentShape: 'circle',
                patternCount: 0,
                changeTime: null,
                best: null,
                attempts: 0,
                history: []
            }
        };

        // LocalStorage functions
        function loadGameData() {
            const saved = localStorage.getItem('clickSpeedGames');
            if (saved) {
                const data = JSON.parse(saved);
                gameState.doubleClick.best = data.doubleClick?.best || null;
                gameState.doubleClick.attempts = data.doubleClick?.attempts || 0;
                gameState.doubleClick.history = data.doubleClick?.history || [];
                gameState.reaction.best = data.reaction?.best || null;
                gameState.reaction.attempts = data.reaction?.attempts || 0;
                gameState.reaction.history = data.reaction?.history || [];
                gameState.placement.best = data.placement?.best || null;
                gameState.placement.attempts = data.placement?.attempts || 0;
                gameState.placement.history = data.placement?.history || [];
                gameState.colorFlash.best = data.colorFlash?.best || null;
                gameState.colorFlash.attempts = data.colorFlash?.attempts || 0;
                gameState.colorFlash.history = data.colorFlash?.history || [];
                gameState.audioReflex.best = data.audioReflex?.best || null;
                gameState.audioReflex.attempts = data.audioReflex?.attempts || 0;
                gameState.audioReflex.history = data.audioReflex?.history || [];
                gameState.shapeShifter.best = data.shapeShifter?.best || null;
                gameState.shapeShifter.attempts = data.shapeShifter?.attempts || 0;
                gameState.shapeShifter.history = data.shapeShifter?.history || [];
            }
            updateAllDisplays();
        }

        function saveGameData() {
            const dataToSave = {
                doubleClick: {
                    best: gameState.doubleClick.best,
                    attempts: gameState.doubleClick.attempts,
                    history: gameState.doubleClick.history.slice(-10) // Keep last 10
                },
                reaction: {
                    best: gameState.reaction.best,
                    attempts: gameState.reaction.attempts,
                    history: gameState.reaction.history.slice(-10)
                },
                placement: {
                    best: gameState.placement.best,
                    attempts: gameState.placement.attempts,
                    history: gameState.placement.history.slice(-10)
                },
                colorFlash: {
                    best: gameState.colorFlash.best,
                    attempts: gameState.colorFlash.attempts,
                    history: gameState.colorFlash.history.slice(-10)
                },
                audioReflex: {
                    best: gameState.audioReflex.best,
                    attempts: gameState.audioReflex.attempts,
                    history: gameState.audioReflex.history.slice(-10)
                },
                shapeShifter: {
                    best: gameState.shapeShifter.best,
                    attempts: gameState.shapeShifter.attempts,
                    history: gameState.shapeShifter.history.slice(-10)
                }
            };
            localStorage.setItem('clickSpeedGames', JSON.stringify(dataToSave));
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function updateAllDisplays() {
            // Update double click
            document.getElementById('best-double').textContent = gameState.doubleClick.best ? formatTime(gameState.doubleClick.best) : '--';
            document.getElementById('attempts-double').textContent = gameState.doubleClick.attempts;
            updateHistory('double', gameState.doubleClick.history);

            // Update reaction
            document.getElementById('best-reaction').textContent = gameState.reaction.best ? formatTime(gameState.reaction.best) : '--';
            document.getElementById('attempts-reaction').textContent = gameState.reaction.attempts;
            updateHistory('reaction', gameState.reaction.history);

            // Update placement
            document.getElementById('best-placement').textContent = gameState.placement.best ? formatTime(gameState.placement.best) : '--';
            document.getElementById('attempts-placement').textContent = gameState.placement.attempts;
            updateHistory('placement', gameState.placement.history);

            // Update color flash
            if (document.getElementById('best-colorflash')) {
                document.getElementById('best-colorflash').textContent = gameState.colorFlash.best ? formatTime(gameState.colorFlash.best) : '--';
                document.getElementById('attempts-colorflash').textContent = gameState.colorFlash.attempts;
                updateHistory('colorflash', gameState.colorFlash.history);
            }

            // Update audio reflex
            if (document.getElementById('best-audioreflex')) {
                document.getElementById('best-audioreflex').textContent = gameState.audioReflex.best ? formatTime(gameState.audioReflex.best) : '--';
                document.getElementById('attempts-audioreflex').textContent = gameState.audioReflex.attempts;
                updateHistory('audioreflex', gameState.audioReflex.history);
            }

            // Update shape shifter
            if (document.getElementById('best-shapeshifter')) {
                document.getElementById('best-shapeshifter').textContent = gameState.shapeShifter.best ? formatTime(gameState.shapeShifter.best) : '--';
                document.getElementById('attempts-shapeshifter').textContent = gameState.shapeShifter.attempts;
                updateHistory('shapeshifter', gameState.shapeShifter.history);
            }
        }

        function updateHistory(gameType, history) {
            const historyElement = document.getElementById(gameType + '-history');
            if (!history.length) {
                historyElement.innerHTML = '<div style="text-align: center; color: #666;">No games played yet</div>';
                return;
            }
            
            let html = '<div style="text-align: center; font-weight: 600; margin-bottom: 10px;">Recent Games</div>';
            history.slice(-5).reverse().forEach((entry, index) => {
                html += `<div class="history-item">
                    <span>#${history.length - index}</span>
                    <span>${formatTime(entry.time)}</span>
                    <span>${new Date(entry.timestamp).toLocaleDateString()}</span>
                </div>`;
            });
            historyElement.innerHTML = html;
        }

        function switchGame(game) {
            document.querySelectorAll('.game-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.game-container').forEach(container => container.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(game + '-game').classList.add('active');
        }

        function formatTime(ms) {
            if (ms < 1000) {
                return ms.toFixed(1) + 'ms';
            } else {
                return (ms / 1000).toFixed(3) + 's';
            }
        }

        // Double Click Game
        function handleDoubleClick() {
            const now = performance.now();
            const clickText = document.getElementById('click-text');
            
            if (gameState.doubleClick.firstClick === null) {
                gameState.doubleClick.firstClick = now;
                clickText.textContent = 'CLICK 2/2';
            } else {
                const timeDiff = now - gameState.doubleClick.firstClick;
                gameState.doubleClick.attempts++;
                
                const isNewRecord = gameState.doubleClick.best === null || timeDiff < gameState.doubleClick.best;
                
                if (isNewRecord) {
                    gameState.doubleClick.best = timeDiff;
                    showNotification('🎉 NEW DOUBLE CLICK RECORD! ' + formatTime(timeDiff));
                }
                
                // Add to history
                gameState.doubleClick.history.push({
                    time: timeDiff,
                    timestamp: Date.now()
                });
                
                document.getElementById('best-double').textContent = formatTime(gameState.doubleClick.best);
                document.getElementById('last-double').textContent = formatTime(timeDiff);
                document.getElementById('attempts-double').textContent = gameState.doubleClick.attempts;
                
                updateHistory('double', gameState.doubleClick.history);
                saveGameData();
                
                gameState.doubleClick.firstClick = null;
                clickText.textContent = 'CLICK 1/2';
            }
        }

        function resetDoubleClick() {
            gameState.doubleClick = {
                firstClick: null,
                best: null,
                attempts: 0,
                history: []
            };
            document.getElementById('best-double').textContent = '--';
            document.getElementById('last-double').textContent = '--';
            document.getElementById('attempts-double').textContent = '0';
            document.getElementById('click-text').textContent = 'CLICK 1/2';
            updateHistory('double', []);
            saveGameData();
        }

        // Reaction Time Game
        function handleReactionClick() {
            const now = performance.now();
            const screen = document.getElementById('reaction-screen');
            const text = document.getElementById('reaction-text');
            
            if (gameState.reaction.state === 'waiting') {
                gameState.reaction.state = 'ready';
                screen.className = 'reaction-screen ready';
                text.textContent = 'WAIT FOR GREEN...';
                
                const delay = Math.random() * 9000 + 1000;
                setTimeout(() => {
                    if (gameState.reaction.state === 'ready') {
                        gameState.reaction.state = 'go';
                        gameState.reaction.readyTime = performance.now();
                        screen.className = 'reaction-screen go';
                        text.textContent = 'CLICK NOW!';
                    }
                }, delay);
                
            } else if (gameState.reaction.state === 'ready') {
                gameState.reaction.state = 'waiting';
                screen.className = 'reaction-screen waiting';
                text.textContent = 'TOO EARLY! CLICK TO RESTART';
                
            } else if (gameState.reaction.state === 'go') {
                const reactionTime = now - gameState.reaction.readyTime;
                gameState.reaction.attempts++;
                
                const isNewRecord = gameState.reaction.best === null || reactionTime < gameState.reaction.best;
                
                if (isNewRecord) {
                    gameState.reaction.best = reactionTime;
                    showNotification('⚡ NEW REACTION RECORD! ' + formatTime(reactionTime));
                }
                
                // Add to history
                gameState.reaction.history.push({
                    time: reactionTime,
                    timestamp: Date.now()
                });
                
                document.getElementById('best-reaction').textContent = formatTime(gameState.reaction.best);
                document.getElementById('last-reaction').textContent = formatTime(reactionTime);
                document.getElementById('attempts-reaction').textContent = gameState.reaction.attempts;
                
                updateHistory('reaction', gameState.reaction.history);
                saveGameData();
                
                gameState.reaction.state = 'waiting';
                screen.className = 'reaction-screen waiting';
                text.textContent = 'GREAT! CLICK TO START AGAIN';
            }
        }

        function resetReaction() {
            gameState.reaction = {
                state: 'waiting',
                startTime: null,
                readyTime: null,
                best: null,
                attempts: 0,
                history: []
            };
            document.getElementById('best-reaction').textContent = '--';
            document.getElementById('last-reaction').textContent = '--';
            document.getElementById('attempts-reaction').textContent = '0';
            document.getElementById('reaction-screen').className = 'reaction-screen waiting';
            document.getElementById('reaction-text').textContent = 'CLICK TO START';
            updateHistory('reaction', []);
            saveGameData();
        }

        // Placement Click Game
        function startPlacementGameWithCountdown() {
            const overlay = document.getElementById('placement-overlay');
            let count = 3;
            
            function countdown() {
                overlay.innerHTML = `<div class="countdown-display">${count}</div>`;
                
                if (count > 0) {
                    count--;
                    setTimeout(countdown, 1000);
                } else {
                    overlay.style.display = 'none';
                    startPlacementGame();
                }
            }
            
            countdown();
        }

        function startPlacementGame() {
            const area = document.getElementById('targets-area');
            const results = document.getElementById('placement-results');
            
            area.innerHTML = '';
            results.style.display = 'none';
            
            gameState.placement.gameActive = true;
            gameState.placement.currentTarget = 0;
            gameState.placement.targetTimes = [];
            gameState.placement.gameStartTime = performance.now();
            
            // Generate 10 random target positions
            const targets = [];
            
            for (let i = 0; i < 10; i++) {
                let attempts = 0;
                let x, y, valid;
                
                do {
                    x = Math.random() * (area.clientWidth - 50) + 10;
                    y = Math.random() * (area.clientHeight - 50) + 10;
                    valid = true;
                    
                    for (let target of targets) {
                        const dx = x - target.x;
                        const dy = y - target.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < 60) {
                            valid = false;
                            break;
                        }
                    }
                    attempts++;
                } while (!valid && attempts < 50);
                
                targets.push({ x, y });
                
                const target = document.createElement('div');
                target.className = 'target';
                target.style.left = x + 'px';
                target.style.top = y + 'px';
                target.textContent = (i + 1);
                target.style.display = i === 0 ? 'flex' : 'none';
                target.onclick = () => handleTargetClick(i);
                area.appendChild(target);
            }
        }

        function handleTargetClick(targetIndex) {
            if (!gameState.placement.gameActive || targetIndex !== gameState.placement.currentTarget) {
                return;
            }
            
            const now = performance.now();
            const clickTime = targetIndex === 0 ? 
                now - gameState.placement.gameStartTime : 
                now - gameState.placement.lastTargetTime;
            
            gameState.placement.targetTimes.push(clickTime);
            gameState.placement.lastTargetTime = now;
            gameState.placement.currentTarget++;
            
            const targets = document.querySelectorAll('.target');
            targets[targetIndex].style.display = 'none';
            
            if (gameState.placement.currentTarget < 10) {
                // Add random delay between 0-2 seconds before showing next target
                const randomDelay = Math.random() * 2000;
                setTimeout(() => {
                    if (gameState.placement.gameActive && gameState.placement.currentTarget < 10) {
                        targets[gameState.placement.currentTarget].style.display = 'flex';
                        gameState.placement.lastTargetTime = performance.now(); // Update time reference after delay
                    }
                }, randomDelay);
            } else {
                finishPlacementGame();
            }
        }

        function finishPlacementGame() {
            gameState.placement.gameActive = false;
            gameState.placement.attempts++;
            
            const totalTime = gameState.placement.targetTimes.reduce((sum, time) => sum + time, 0);
            
            const isNewRecord = gameState.placement.best === null || totalTime < gameState.placement.best;
            
            if (isNewRecord) {
                gameState.placement.best = totalTime;
                showNotification('🎯 NEW PLACEMENT RECORD! ' + formatTime(totalTime));
            }
            
            // Add to history
            gameState.placement.history.push({
                time: totalTime,
                timestamp: Date.now()
            });
            
            document.getElementById('best-placement').textContent = formatTime(gameState.placement.best);
            document.getElementById('last-placement').textContent = formatTime(totalTime);
            document.getElementById('attempts-placement').textContent = gameState.placement.attempts;
            
            updateHistory('placement', gameState.placement.history);
            saveGameData();
            
            // Show individual results
            const results = document.getElementById('placement-results');
            let resultsHTML = '<h3>Individual Times:</h3>';
            gameState.placement.targetTimes.forEach((time, index) => {
                resultsHTML += `<div>Target ${index + 1}: ${formatTime(time)}</div>`;
            });
            results.innerHTML = resultsHTML;
            results.style.display = 'block';
        }

        function resetPlacement() {
            gameState.placement = {
                gameActive: false,
                currentTarget: 0,
                gameStartTime: null,
                targetTimes: [],
                best: null,
                attempts: 0,
                history: []
            };
            document.getElementById('best-placement').textContent = '--';
            document.getElementById('last-placement').textContent = '--';
            document.getElementById('attempts-placement').textContent = '0';
            document.getElementById('targets-area').innerHTML = `
                <div class="placement-overlay" id="placement-overlay">
                    <button class="placement-start-btn" onclick="startPlacementGameWithCountdown()">START GAME</button>
                </div>
            `;
            document.getElementById('placement-results').style.display = 'none';
            updateHistory('placement', []);
            saveGameData();
        }

        // Color Flash Game
        function handleColorFlash() {
            const now = performance.now();
            const screen = document.getElementById('color-flash-screen');
            const text = document.getElementById('color-flash-text');
            const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
            const colorMap = {
                red: '#ff4444', blue: '#4444ff', green: '#44ff44',
                yellow: '#ffff44', purple: '#ff44ff', orange: '#ff8844'
            };
            
            if (gameState.colorFlash.state === 'waiting') {
                gameState.colorFlash.state = 'active';
                gameState.colorFlash.targetColor = colors[Math.floor(Math.random() * colors.length)];
                document.getElementById('color-target').textContent = `TARGET: ${gameState.colorFlash.targetColor.toUpperCase()}`;
                text.textContent = 'WATCH FOR THE COLOR...';
                screen.style.background = '#1a1a1a';
                
                const startDelay = Math.random() * 5000 + 1000;
                setTimeout(() => {
                    if (gameState.colorFlash.state === 'active') {
                        const flashColor = Math.random() < 0.3 ? gameState.colorFlash.targetColor : colors[Math.floor(Math.random() * colors.length)];
                        gameState.colorFlash.currentColor = flashColor;
                        screen.style.background = colorMap[flashColor];
                        text.textContent = flashColor === gameState.colorFlash.targetColor ? 'TAP NOW!' : 'WRONG COLOR';
                        
                        if (flashColor === gameState.colorFlash.targetColor) {
                            gameState.colorFlash.flashTime = performance.now();
                        }
                        
                        setTimeout(() => {
                            if (gameState.colorFlash.state === 'active') {
                                finishColorFlash(false);
                            }
                        }, 800);
                    }
                }, startDelay);
                
            } else if (gameState.colorFlash.state === 'active') {
                if (gameState.colorFlash.currentColor === gameState.colorFlash.targetColor && gameState.colorFlash.flashTime) {
                    const reactionTime = now - gameState.colorFlash.flashTime;
                    finishColorFlash(true, reactionTime);
                } else {
                    finishColorFlash(false);
                }
            }
        }

        function finishColorFlash(success, reactionTime = null) {
            gameState.colorFlash.attempts++;
            const screen = document.getElementById('color-flash-screen');
            const text = document.getElementById('color-flash-text');
            
            if (success && reactionTime) {
                const isNewRecord = gameState.colorFlash.best === null || reactionTime < gameState.colorFlash.best;
                
                if (isNewRecord) {
                    gameState.colorFlash.best = reactionTime;
                    showNotification('🎨 NEW COLOR FLASH RECORD! ' + formatTime(reactionTime));
                }
                
                gameState.colorFlash.history.push({
                    time: reactionTime,
                    timestamp: Date.now()
                });
                
                document.getElementById('best-colorflash').textContent = formatTime(gameState.colorFlash.best);
                document.getElementById('last-colorflash').textContent = formatTime(reactionTime);
            } else {
                document.getElementById('last-colorflash').textContent = 'MISS';
            }
            
            document.getElementById('attempts-colorflash').textContent = gameState.colorFlash.attempts;
            updateHistory('colorflash', gameState.colorFlash.history);
            saveGameData();
            
            gameState.colorFlash.state = 'waiting';
            gameState.colorFlash.currentColor = null;
            gameState.colorFlash.flashTime = null;
            screen.style.background = '#1a1a1a';
            text.textContent = 'TAP TO START AGAIN';
        }

        function resetColorFlash() {
            gameState.colorFlash = {
                state: 'waiting',
                currentColor: null,
                targetColor: 'red',
                flashTime: null,
                best: null,
                attempts: 0,
                history: []
            };
            document.getElementById('best-colorflash').textContent = '--';
            document.getElementById('last-colorflash').textContent = '--';
            document.getElementById('attempts-colorflash').textContent = '0';
            document.getElementById('color-flash-text').textContent = 'TAP TO START';
            document.getElementById('color-flash-screen').style.background = '#1a1a1a';
            updateHistory('colorflash', []);
            saveGameData();
        }

        // Audio Reflex Game
        function handleAudioReflex() {
            const now = performance.now();
            const screen = document.getElementById('audio-reflex-screen');
            const text = document.getElementById('audio-reflex-text');
            
            if (gameState.audioReflex.state === 'waiting') {
                gameState.audioReflex.state = 'listening';
                text.textContent = 'LISTEN CAREFULLY...';
                screen.style.background = '#1a1a1a';
                
                const audioDelay = Math.random() * 6000 + 2000;
                setTimeout(() => {
                    if (gameState.audioReflex.state === 'listening') {
                        gameState.audioReflex.state = 'ready';
                        gameState.audioReflex.audioTime = performance.now();
                        text.textContent = 'TAP NOW!';
                        screen.style.background = '#00ff41';
                        screen.style.color = '#0a0a0a';
                        
                        // Create audio beep using Web Audio API
                        try {
                            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                            const oscillator = audioContext.createOscillator();
                            const gainNode = audioContext.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(audioContext.destination);
                            
                            oscillator.frequency.value = 800;
                            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                            
                            oscillator.start(audioContext.currentTime);
                            oscillator.stop(audioContext.currentTime + 0.5);
                        } catch (e) {
                            console.log('Audio not supported');
                        }
                        
                        setTimeout(() => {
                            if (gameState.audioReflex.state === 'ready') {
                                finishAudioReflex(false);
                            }
                        }, 2000);
                    }
                }, audioDelay);
                
            } else if (gameState.audioReflex.state === 'listening') {
                // Too early
                finishAudioReflex(false, 'TOO EARLY');
            } else if (gameState.audioReflex.state === 'ready') {
                const reactionTime = now - gameState.audioReflex.audioTime;
                finishAudioReflex(true, reactionTime);
            }
        }

        function finishAudioReflex(success, reactionTime = null) {
            gameState.audioReflex.attempts++;
            const screen = document.getElementById('audio-reflex-screen');
            const text = document.getElementById('audio-reflex-text');
            
            if (success && typeof reactionTime === 'number') {
                const isNewRecord = gameState.audioReflex.best === null || reactionTime < gameState.audioReflex.best;
                
                if (isNewRecord) {
                    gameState.audioReflex.best = reactionTime;
                    showNotification('🔊 NEW AUDIO REFLEX RECORD! ' + formatTime(reactionTime));
                }
                
                gameState.audioReflex.history.push({
                    time: reactionTime,
                    timestamp: Date.now()
                });
                
                document.getElementById('best-audioreflex').textContent = formatTime(gameState.audioReflex.best);
                document.getElementById('last-audioreflex').textContent = formatTime(reactionTime);
            } else {
                document.getElementById('last-audioreflex').textContent = reactionTime === 'TOO EARLY' ? 'TOO EARLY' : 'MISS';
            }
            
            document.getElementById('attempts-audioreflex').textContent = gameState.audioReflex.attempts;
            updateHistory('audioreflex', gameState.audioReflex.history);
            saveGameData();
            
            gameState.audioReflex.state = 'waiting';
            gameState.audioReflex.audioTime = null;
            screen.style.background = '#1a1a1a';
            screen.style.color = '#00ff41';
            text.textContent = 'TAP TO START AGAIN';
        }

        function resetAudioReflex() {
            gameState.audioReflex = {
                state: 'waiting',
                audioTime: null,
                best: null,
                attempts: 0,
                history: []
            };
            document.getElementById('best-audioreflex').textContent = '--';
            document.getElementById('last-audioreflex').textContent = '--';
            document.getElementById('attempts-audioreflex').textContent = '0';
            document.getElementById('audio-reflex-text').textContent = 'TAP TO START';
            document.getElementById('audio-reflex-screen').style.background = '#1a1a1a';
            document.getElementById('audio-reflex-screen').style.color = '#00ff41';
            updateHistory('audioreflex', []);
            saveGameData();
        }

        // Shape Shifter Game
        function handleShapeShifter() {
            const now = performance.now();
            const screen = document.getElementById('shape-shifter-screen');
            const display = document.getElementById('shape-display');
            const text = document.getElementById('shape-shifter-text');
            const shapes = ['●', '■', '▲', '♦'];
            const shapeNames = ['circle', 'square', 'triangle', 'diamond'];
            const shapeClasses = ['shape-circle', 'shape-square', 'shape-triangle', 'shape-diamond'];
            
            if (gameState.shapeShifter.state === 'waiting') {
                gameState.shapeShifter.state = 'pattern';
                gameState.shapeShifter.currentShape = 'circle';
                gameState.shapeShifter.patternCount = 0;
                text.textContent = 'WATCH FOR THE DIFFERENT SHAPE...';
                
                function showPattern() {
                    if (gameState.shapeShifter.state !== 'pattern') return;
                    
                    display.textContent = shapes[0]; // Always start with circle
                    display.className = 'shape-display ' + shapeClasses[0];
                    gameState.shapeShifter.patternCount++;
                    
                    if (gameState.shapeShifter.patternCount > 3 && Math.random() < 0.25) {
                        // Show different shape
                        const differentShape = Math.floor(Math.random() * 3) + 1; // 1, 2, or 3 (not 0)
                        setTimeout(() => {
                            if (gameState.shapeShifter.state === 'pattern') {
                                display.textContent = shapes[differentShape];
                                display.className = 'shape-display ' + shapeClasses[differentShape];
                                gameState.shapeShifter.changeTime = performance.now();
                                gameState.shapeShifter.state = 'changed';
                                
                                setTimeout(() => {
                                    if (gameState.shapeShifter.state === 'changed') {
                                        finishShapeShifter(false);
                                    }
                                }, 1500);
                            }
                        }, 500);
                    } else {
                        setTimeout(() => {
                            showPattern();
                        }, Math.random() * 800 + 600);
                    }
                }
                
                showPattern();
                
            } else if (gameState.shapeShifter.state === 'changed') {
                const reactionTime = now - gameState.shapeShifter.changeTime;
                finishShapeShifter(true, reactionTime);
            } else if (gameState.shapeShifter.state === 'pattern') {
                finishShapeShifter(false, 'TOO EARLY');
            }
        }

        function finishShapeShifter(success, reactionTime = null) {
            gameState.shapeShifter.attempts++;
            const screen = document.getElementById('shape-shifter-screen');
            const display = document.getElementById('shape-display');
            const text = document.getElementById('shape-shifter-text');
            
            if (success && typeof reactionTime === 'number') {
                const isNewRecord = gameState.shapeShifter.best === null || reactionTime < gameState.shapeShifter.best;
                
                if (isNewRecord) {
                    gameState.shapeShifter.best = reactionTime;
                    showNotification('🔺 NEW SHAPE SHIFTER RECORD! ' + formatTime(reactionTime));
                }
                
                gameState.shapeShifter.history.push({
                    time: reactionTime,
                    timestamp: Date.now()
                });
                
                document.getElementById('best-shapeshifter').textContent = formatTime(gameState.shapeShifter.best);
                document.getElementById('last-shapeshifter').textContent = formatTime(reactionTime);
            } else {
                document.getElementById('last-shapeshifter').textContent = reactionTime === 'TOO EARLY' ? 'TOO EARLY' : 'MISS';
            }
            
            document.getElementById('attempts-shapeshifter').textContent = gameState.shapeShifter.attempts;
            updateHistory('shapeshifter', gameState.shapeShifter.history);
            saveGameData();
            
            gameState.shapeShifter.state = 'waiting';
            gameState.shapeShifter.patternCount = 0;
            gameState.shapeShifter.changeTime = null;
            display.textContent = '●';
            display.className = 'shape-display shape-circle';
            text.textContent = 'TAP TO START AGAIN';
        }

        function resetShapeShifter() {
            gameState.shapeShifter = {
                state: 'waiting',
                currentShape: 'circle',
                patternCount: 0,
                changeTime: null,
                best: null,
                attempts: 0,
                history: []
            };
            document.getElementById('best-shapeshifter').textContent = '--';
            document.getElementById('last-shapeshifter').textContent = '--';
            document.getElementById('attempts-shapeshifter').textContent = '0';
            document.getElementById('shape-shifter-text').textContent = 'TAP TO START';
            document.getElementById('shape-display').textContent = '●';
            document.getElementById('shape-display').className = 'shape-display shape-circle';
            updateHistory('shapeshifter', []);
            saveGameData();
        }

        function resetAllProgress() {
            if (confirm('Are you sure you want to reset ALL game progress? This cannot be undone!')) {
                localStorage.removeItem('clickSpeedGames');
                gameState.doubleClick = { firstClick: null, best: null, attempts: 0, history: [] };
                gameState.reaction = { state: 'waiting', startTime: null, readyTime: null, best: null, attempts: 0, history: [] };
                gameState.placement = { gameActive: false, currentTarget: 0, gameStartTime: null, targetTimes: [], best: null, attempts: 0, history: [] };
                gameState.colorFlash = { state: 'waiting', currentColor: null, targetColor: 'red', flashTime: null, best: null, attempts: 0, history: [] };
                gameState.audioReflex = { state: 'waiting', audioTime: null, best: null, attempts: 0, history: [] };
                gameState.shapeShifter = { state: 'waiting', currentShape: 'circle', patternCount: 0, changeTime: null, best: null, attempts: 0, history: [] };
                
                document.getElementById('click-text').textContent = 'CLICK 1/2';
                document.getElementById('reaction-screen').className = 'reaction-screen waiting';
                document.getElementById('reaction-text').textContent = 'CLICK TO START';
                document.getElementById('targets-area').innerHTML = `
                    <div class="placement-overlay" id="placement-overlay">
                        <button class="placement-start-btn" onclick="startPlacementGameWithCountdown()">START GAME</button>
                    </div>
                `;
                document.getElementById('placement-results').style.display = 'none';
                
                if (document.getElementById('color-flash-text')) {
                    document.getElementById('color-flash-text').textContent = 'TAP TO START';
                    document.getElementById('color-flash-screen').style.background = '#1a1a1a';
                }
                
                if (document.getElementById('audio-reflex-text')) {
                    document.getElementById('audio-reflex-text').textContent = 'TAP TO START';
                    document.getElementById('audio-reflex-screen').style.background = '#1a1a1a';
                    document.getElementById('audio-reflex-screen').style.color = '#00ff41';
                }
                
                if (document.getElementById('shape-shifter-text')) {
                    document.getElementById('shape-shifter-text').textContent = 'TAP TO START';
                    document.getElementById('shape-display').textContent = '●';
                    document.getElementById('shape-display').className = 'shape-display shape-circle';
                }
                
                updateAllDisplays();
                showNotification('🔄 ALL PROGRESS RESET');
            }
        }

        // Initialize double-click button event listeners for better responsiveness
        function initDoubleClickButton() {
            const button = document.getElementById('double-click-button');
            
            // Remove default onclick to avoid conflicts
            button.removeAttribute('onclick');
            
            // Add both touch and mouse events for maximum responsiveness
            button.addEventListener('touchstart', handleDoubleClick, { passive: true });
            button.addEventListener('mousedown', handleDoubleClick);
            
            // Prevent default behaviors that might interfere
            button.addEventListener('touchend', (e) => e.preventDefault());
            button.addEventListener('click', (e) => e.preventDefault());
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            loadGameData();
            checkMobile();
            initDoubleClickButton();
            initPullToRefresh();
        });

        // Prevent context menu on mobile
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        // Optimize for mobile touch events
        document.addEventListener('touchstart', function() {}, { passive: true });
        document.addEventListener('touchend', function() {}, { passive: true });
        
        // Prevent double-tap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>